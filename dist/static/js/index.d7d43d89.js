"use strict";(self.webpackChunktext_formatter=self.webpackChunktext_formatter||[]).push([[826],{30096:(e,t,n)=>{n.d(t,{Z:()=>xe});var i=n(7822),r=n(13852),l=n(48670);r.use(l.Db).init({resources:{zh:{translation:{no_space_around_full_width_punctuation:"\u5168\u89d2\u6807\u70b9\u4e0e\u5176\u4ed6\u5b57\u7b26\u4e4b\u95f4\u4e0d\u52a0\u7a7a\u683c",no_space_between_num_dp:"\u5ea6\u6570\u3001\u767e\u5206\u6bd4\u4e0e\u6570\u5b57\u4e4b\u95f4\u4e0d\u9700\u8981\u589e\u52a0\u7a7a\u683c",space_between_ch_en:"\u4e2d\u6587\u548c\u82f1\u6587\u3001\u6570\u5b57\u4e4b\u95f4\u9700\u8981\u589e\u52a0\u7a7a\u683c",uniform_punctuation:"\u7edf\u4e00\u6807\u70b9\u7b26\u53f7",content:"\u95ee\u9898\u5185\u5bb9",view:"\u67e5\u770b",fix:"\u4fee\u590d",fix_all:"\u5168\u90e8\u4fee\u590d",actions:"\u64cd\u4f5c",refresh:"\u5237\u65b0",format_target:"\u6392\u7248\u8303\u56f4",format_rule:"\u6392\u7248\u89c4\u5219",text_field_only:"\u8bf7\u9009\u62e9\u6587\u672c\u7c7b\u578b\u7684\u5b57\u6bb5",cell:"\u9009\u4e2d\u5355\u5143\u683c",field:"\u9009\u4e2d\u5217",fixing:"\u4fee\u590d\u4e2d",fix_success:"\u4fee\u590d\u6210\u529f"}},en:{translation:{no_space_around_full_width_punctuation:"No space around full-width punctuation",no_space_between_num_dp:"No space needed between numbers and degrees, percentages",space_between_ch_en:"Add space between Chinese and English, numbers",uniform_punctuation:"Uniform punctuation",content:"Content",view:"View",fix:"Fix",fix_all:"Fix All",actions:"Actions",refresh:"Refresh",format_target:"Formatting Scope",format_rule:"Formatting Rules",text_field_only:"Please select text type fields",cell:"Selected Cell",field:"Selected Column",fixing:"Fixing",fix_success:"Fix Successful"}},ja:{translation:{no_space_around_full_width_punctuation:"\u5168\u89d2\u53e5\u8aad\u70b9\u306e\u5468\u308a\u306b\u30b9\u30da\u30fc\u30b9\u3092\u5165\u308c\u306a\u3044",no_space_between_num_dp:"\u6570\u5b57\u3068\u5ea6\u6570\u3001\u30d1\u30fc\u30bb\u30f3\u30c6\u30fc\u30b8\u306e\u9593\u306b\u30b9\u30da\u30fc\u30b9\u306f\u4e0d\u8981",space_between_ch_en:"\u4e2d\u56fd\u8a9e\u3068\u82f1\u8a9e\u3001\u6570\u5b57\u306e\u9593\u306b\u30b9\u30da\u30fc\u30b9\u3092\u5165\u308c\u308b",uniform_punctuation:"\u53e5\u8aad\u70b9\u3092\u7d71\u4e00\u3059\u308b",content:"\u5185\u5bb9",view:"\u8868\u793a",fix:"\u4fee\u6b63",fix_all:"\u3059\u3079\u3066\u4fee\u6b63",actions:"\u64cd\u4f5c",refresh:"\u66f4\u65b0",format_target:"\u6574\u5f62\u7bc4\u56f2",format_rule:"\u6574\u5f62\u30eb\u30fc\u30eb",text_field_only:"\u30c6\u30ad\u30b9\u30c8\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u307f\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044",cell:"\u9078\u629e\u3057\u305f\u30bb\u30eb",field:"\u9078\u629e\u3057\u305f\u5217",fixing:"\u4fee\u6b63\u4e2d",fix_success:"\u4fee\u6b63\u5b8c\u4e86"}}},lng:"zh",fallbackLng:"en",interpolation:{escapeValue:!1}}),i.ws.bridge.getLanguage().then(r.changeLanguage).finally(console.error);var s=r,a=(n(38068),n(15969)),o=(n(96928),n(63498)),c=(n(73824),n(29274)),d=n(4832),u=n(30473),p=n(37694),f=n(20131),_=n(69471),x=n(63627),m=n(47942),g=n(81168),h=n(95473),w=n(4917),b=n(56078),y=n(43049),j=n(6835),Z=n(97390),v=n(38820),I=n(52983),C=n(34719),O=n(91836),D=n(35272),T=n(82745),k=(n(31343),n(41898)),F=n(85903),N=n.n(F),R=n(75639);const S=new Worker(new URL(n.p+n.u(439),n.b)),L=(0,R.Ud)(S).module,A=["space_between_ch_en","no_space_between_num_dp","uniform_punctuation","no_space_around_full_width_punctuation"],E=function(){var e=(0,u.Z)((function*(e){return JSON.parse(yield(yield L).fix(JSON.stringify(e)))}));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=(0,u.Z)((function*(e){return JSON.parse(yield(yield L).test(JSON.stringify(e)))}));return function(t){return e.apply(this,arguments)}}();var V=n(97458);const G=({text:e,rulesResult:t,configs:n})=>{const{t:i}=(0,l.$G)(),r=(0,I.useMemo)((()=>t.flatMap(((e,t)=>(null==e?void 0:e.map((([e,i])=>(new(N())).retain(e).retain(i-e,{[A.indexOf(n[t])]:!0}))))||[])).reduce(((e,t)=>e.compose(t)),new(N())([{insert:e}]))),[e,t,n]);return(0,V.jsx)(V.Fragment,{children:r.map(((e,t)=>{if("string"==typeof e.insert){const n=Object.keys(e.attributes||{}).filter((t=>{var n;return null===(n=e.attributes)||void 0===n?void 0:n[t]})).map((e=>Number(e)));return n.length?(0,V.jsx)(k.Z,{content:n.map((e=>i(A[e]))).join("\n"),children:(0,V.jsx)("span",{className:"bg-red-200 border-b-2 border-red-600 cursor-pointer",children:e.insert})},t):(0,V.jsx)("span",{children:e.insert},t)}return null}))})};var $=n(65232),M=n(49636),z=n(64774),J=n(70801),X=n(46685),B=n(65315),P=n(14745),K=n(23587),W=n(87940),q=n(67127);const H=new f.X("cell");i.ws.bridge.getData("mode").then((e=>{e&&!(0,q.Z)(e)&&H.next(e)})).catch(console.error).finally((()=>H.pipe((0,$.x)()).subscribe((e=>{i.ws.bridge.setData("mode",e).catch(console.error)}))));const Q=new f.X({no_space_around_full_width_punctuation:!0,no_space_between_num_dp:!0,space_between_ch_en:!0,uniform_punctuation:!0});i.ws.bridge.getData("config").then((e=>{e&&!(0,q.Z)(e)&&Q.next(e)})).catch(console.error).finally((()=>Q.pipe((0,$.x)(K.Z)).subscribe((e=>{i.ws.bridge.setData("config",e).catch(console.error)}))));const Y=(0,h.D)(i.ws.base.getSelection()).pipe((0,g.w)((e=>(0,M.R)((e=>i.ws.base.onSelectionChange((({data:t})=>e(t)))),((e,t)=>t())).pipe((0,b.O)(e)))),(0,$.x)(K.Z)),ee=Y.pipe((0,w.U)((({tableId:e})=>e)),(0,$.x)(),(0,g.w)((e=>(0,h.D)(i.ws.base.getTableById(e)).pipe((0,g.w)((e=>(0,z.T)([(0,M.R)((t=>e.onFieldAdd(t)),((e,t)=>t())),(0,M.R)((t=>e.onFieldModify(t)),((e,t)=>t())),(0,M.R)((t=>e.onFieldDelete(t)),((e,t)=>t()))]).pipe((0,g.w)((()=>(0,J.a)([(0,h.D)(e.getFieldList()),Y.pipe((0,w.U)((({fieldId:e,recordId:t})=>({fieldId:e,recordId:t}))),(0,$.x)())]).pipe((0,g.w)((([t,{fieldId:n,recordId:i}])=>{const r=t.find((({id:e})=>e===n));return r&&n&&i?(0,h.D)(r.getType()).pipe((0,w.U)((t=>({field:r,table:e,fieldType:t,fieldId:n,recordId:i})))):X.E})),(0,b.O)(null)))),(0,b.O)(null)))),(0,B.K)((()=>(0,Z.of)(null))),(0,b.O)(null)))),(0,$.x)(((e,t)=>(0,K.Z)((0,W.Z)(e,["fieldType","fieldId","recordId"]),(0,W.Z)(t,["fieldType","fieldId","recordId"])))),(0,P.B)());function te(e){return e.flatMap((({value:e,record_id:t})=>e&&i.C4.isSegments(e)?e.map((({type:e,text:t},n)=>({type:e,text:t,index:n}))).filter((({type:e})=>e===i.N1.Text)).map((({text:e,index:n})=>({text:e,record_id:t,index:n}))):[]))}function ne(){return(ne=(0,u.Z)((function*(e,t,n){se.next(!0);const i=Date.now(),r=te(yield"cell"===t?e.table.getCellValue(e.fieldId,e.recordId).then((t=>[{record_id:e.recordId,value:t}])):e.field.getFieldValueList("")),l=yield U({config:n,texts:r.map((({text:e})=>e))});return console.log(`formatTest: ${Date.now()-i}ms`),se.next(!1),{config:l.config,result:Object.entries((0,C.Z)(l.result.map(((e,t)=>(0,d.Z)({rulesResult:e},r[t]))).filter((({rulesResult:e})=>e.some(D.Z))),"record_id")).map((([e,t])=>({recordId:e,segments:(0,O.Z)(t,"index")})))}}))).apply(this,arguments)}function ie(e,t,n){return re.apply(this,arguments)}function re(){return(re=(0,u.Z)((function*({table:e,field:t,fieldId:n},r,l){const o=a.Z.loading({duration:36e5,content:s.t("fixing")}),c=yield"ALL"!==l?e.getCellValue(n,l).then((e=>[{record_id:l,value:e}])):t.getFieldValueList(""),d=te(c),{result:u}=yield E({config:Object.fromEntries(r.map((e=>[e,!0]))),texts:d.map((({text:e})=>e))}),p=Object.fromEntries(c.map((({record_id:e,value:t})=>[e,t]))),f={};u.forEach(((e,t)=>{if(e!==d[t].text){const n=p[d[t].record_id];n&&i.C4.isSegments(n)&&(n[d[t].index].text=e),f[d[t].record_id]=!0}})),yield Promise.all((0,T.Z)(Object.keys(f).filter((e=>f[e]&&p[e])),5e3).map((t=>e.setRecords(t.map((e=>({recordId:e,fields:{[n]:p[e]}}))))))),o(),le.next(Date.now()),i.ws.ui.showToast({toastType:i.pC.success,message:s.t("fix_success")})}))).apply(this,arguments)}ee.subscribe((e=>{e&&e.fieldType!==i.fS.Text&&i.ws.ui.showToast({toastType:i.pC.warning,message:s.t("text_field_only")})}));const le=new f.X(0),se=new f.X(!1),ae=()=>(0,p.pw)((0,p.mA)((()=>ee.pipe((0,_.T)(1),(0,x.h)((e=>Boolean(e)&&(null==e?void 0:e.fieldType)===i.fS.Text)),(0,m.V)(H,Q,le),(0,g.w)((([e,t,n])=>(0,h.D)(function(e,t,n){return ne.apply(this,arguments)}(e,t,n)).pipe((0,w.U)((t=>(0,V.jsx)(oe,(0,d.Z)((0,d.Z)({},t),{},{selection:e})))))))))),null),oe=({result:e,config:t,selection:n})=>{const{t:r}=(0,l.$G)(),s=(0,p.pw)((0,p.mA)((()=>se.pipe((0,b.O)(!1),(0,y.G)(),(0,j.b)((([e,t])=>e&&!t?(0,Z.of)(!1).pipe((0,v.g)(300)):(0,Z.of)(t)))))),!1),a=(0,I.useMemo)((()=>[{title:r("content"),dataIndex:"segments",render:(e,n)=>(0,V.jsx)("div",{className:"whitespace-pre-wrap break-all",children:n.segments.map((e=>(0,I.createElement)(G,(0,d.Z)((0,d.Z)({},e),{},{configs:t,key:e.index}))))})},{title:r("actions"),render:(e,l)=>(0,V.jsxs)("div",{className:"whitespace-nowrap",children:[(0,V.jsx)(c.Z,{size:"mini",className:"mr-2",onClick:()=>i.ws.ui.showRecordDetailDialog({tableId:n.table.id,recordId:l.recordId}),children:r("view")}),(0,V.jsx)(c.Z,{size:"mini",type:"primary",onClick:()=>ie(n,t,l.recordId),children:r("fix")})]})}]),[r,t,n]);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)("div",{className:"gap-2 flex justify-end mb-3",children:[(0,V.jsx)(c.Z,{onClick:()=>le.next(Date.now()),loading:s,disabled:s,children:r("refresh")}),(0,V.jsx)(c.Z,{type:"primary",onClick:()=>ie(n,t,"ALL"),children:r("fix_all")})]}),(0,V.jsx)(o.Z,{data:e,columns:a,rowKey:"recordId"})]})};n(39065);var ce=n(96977),de=(n(94821),n(50671));n(32859);const ue=n(80805).Z.Group,pe=de.Z.Group,fe=()=>{const e=(0,p.Ro)(H),t=(0,p.Ro)(Q),{t:n}=(0,l.$G)();return(0,V.jsxs)(ce.Z,{children:[(0,V.jsx)(ce.Z.Item,{label:n("format_target"),children:(0,V.jsxs)(pe,{value:e,onChange:e=>H.next(e),className:"pr-4",direction:"vertical",children:[(0,V.jsx)(de.Z,{value:"cell",children:n("cell")}),(0,V.jsx)(de.Z,{value:"field",children:n("field")})]})}),(0,V.jsx)(ce.Z.Item,{label:n("format_rule"),children:(0,V.jsx)(ue,{options:A.map(((e,t)=>({value:e,label:`${t+1}. ${n(e)}`}))),value:Object.keys(t).filter((e=>t[e])),onChange:e=>Q.next(Object.fromEntries(e.map((e=>[e,!0])))),direction:"vertical"})})]})},_e=()=>(0,V.jsx)(V.Fragment,{children:(0,V.jsxs)("div",{className:"py-4 px-6",children:[(0,V.jsx)(fe,{}),(0,V.jsx)(ae,{})]})});var xe=()=>(0,V.jsx)("div",{children:(0,V.jsx)(_e,{})})},18026:(e,t,n)=>{n(60729),n(12318),n(19306),n(19343),n(94834),n(84913),n(95086),n(39629),n(28238),n(58534),n(43841),n(81186),n(29756),n(53430),n(81744),n(14794),n(21670),n(22502),n(24804),n(83956),n(71945),n(53453),n(38476),n(40878),n(83994),n(20098),n(58651),n(77053),n(73955),n(17546),n(86820),n(8311),n(23205),n(33989),n(73874),n(52931),n(19484),n(45889),n(55961),n(65816),n(86874),n(39814),n(68718),n(4584),n(97071),n(19195),n(70761),n(13444),n(59215),n(53063),n(27232),n(99333),n(63305),n(5024),n(66795),n(83964),n(50212),n(27695),n(40270),n(64591),n(89456),n(49036),n(77228),n(27806),n(69788),n(7930),n(99170),n(84592),n(94718),n(52501),n(78763),n(94787),n(10627),n(97267),n(95079),n(33776),n(68493),n(19182),n(71360),n(89485),n(65435),n(27310),n(428),n(11158),n(6406),n(76735),n(82291),n(89121),n(60879),n(20787),n(64304),n(45786),n(48577),n(30097),n(1725),n(83074),n(77154),n(79912),n(34757),n(32392),n(45703),n(67838),n(86895),n(81115),n(69629),n(61995),n(95928),n(62410),n(66364),n(26249),n(16035),n(54964),n(7110),n(7355),n(83383),n(30774),n(69067),n(49750),n(87949),n(82614),n(35879),n(23522),n(32324),n(90203),n(86524),n(97932),n(91260),n(71678),n(3988),n(48521),n(90156),n(12282),n(84283),n(68364),n(13092),n(85737),n(75970),n(5298),n(25676),n(43364),n(68583),n(71030),n(65553),n(74656),n(17346),n(41605),n(5222),n(3969),n(51176),n(79960),n(25627),n(65997),n(79788),n(165),n(90819),n(89607),n(3370),n(46755),n(73489),n(20955),n(93912),n(69735),n(66396),n(9409),n(57884),n(67039),n(48417),n(58300),n(24347),n(23185),n(43968),n(52127),n(14550),n(94097),n(3563),n(11680),n(90423),n(34628),n(86007),n(37400),n(94046),n(60565),n(93264),n(25908),n(2857),n(5904),n(16901),n(60346),n(15506),n(21940),n(52755),n(78993),n(83060),n(2309),n(88771),n(25218),n(66497),n(56855),n(71171),n(69217),n(74464),n(36587),n(99806),n(97858),n(42645),n(5945),n(41828),n(66919),n(3664),n(64649),n(29436),n(69690),n(26463),n(93976),n(69391),n(41275),n(44077),n(24438),n(96585),n(34797),n(75948),n(4914),n(25641),n(33074),n(57593),n(13354),n(19297),n(50950),n(45099),n(66019),n(98960),n(29532),n(43212),n(8580),n(1874),n(57305),n(87357),n(63898),n(42584),n(5960),n(65872),n(49880),n(6054),n(51867),n(37042),n(6130),n(43655),n(52860),n(36256),n(43243),n(68806),n(17502),n(53682),n(56367),n(61335),n(48467),n(3859),n(76277),n(66510),n(56489),n(17913),n(54773),n(64586),n(1018),n(31767),n(80202),n(29731),n(81003),n(54367),n(90792),n(95975),n(24739),n(34099),n(44216),n(1775),n(79072),n(96426),n(97151),n(43001),n(88096),n(61398),n(68494),n(5270),n(73403),n(18145),n(32845),n(71958),n(51428),n(69786),n(63330),n(64064),n(47527),n(26624),n(30924)},15365:()=>{window.__assetPrefix__=""}},e=>{var t=t=>e(e.s=t);e.O(0,[986,991,649,193,651,895],(()=>(t(18026),t(15365),t(80957))));e.O()}]);