(()=>{"use strict";var e,t,n,r,i,o={8408:()=>{window.__assetPrefix__="."},82433:(e,t,n)=>{n(24162),n(67987),n(2854),n(99991),n(74840),n(97914),n(77440),n(25255),n(66156),n(22589),n(91758),n(37945),n(4524),n(75428),n(26311),n(79998),n(58573),n(24675),n(62073),n(5714),n(42217),n(56067),n(83349),n(14546),n(22759),n(33135),n(3092),n(87682),n(76967),n(68274),n(11272),n(46038),n(76979),n(55960),n(88336),n(63269),n(89506),n(59694),n(96111),n(3446),n(27710),n(86354),n(97531),n(28650),n(98977),n(92870),n(22701),n(70161),n(77341),n(87836),n(79995),n(88805),n(21572),n(3049),n(87256),n(47443),n(58835),n(41853),n(87028),n(27508),n(19814),n(24165),n(16892),n(73626),n(14104),n(74488),n(20796),n(37048),n(55122),n(40412),n(71557),n(22945),n(38095),n(43805),n(293),n(69777),n(17777),n(80845),n(65181),n(65172),n(87221),n(78730),n(78347),n(83300),n(25410),n(60766),n(87085),n(80519),n(97193),n(44181),n(48633),n(61992),n(64937),n(7120),n(67925),n(20190),n(90868),n(26868),n(34800),n(21879),n(28468),n(11573),n(13282),n(21997),n(14179),n(91624),n(14725),n(89315),n(89830),n(19912),n(53819),n(84193),n(17562),n(38509),n(23707),n(45506),n(70486),n(14399),n(73042),n(29552),n(79266),n(87805),n(43649),n(62526),n(1687),n(97976),n(68547),n(40052),n(72863),n(37064),n(1078),n(92708),n(49439),n(35213),n(80061),n(59308),n(26739),n(72585),n(50591),n(44053),n(74643),n(95164),n(26591),n(86356),n(23994),n(99674),n(15905),n(47097),n(97761),n(11420),n(95200),n(80230),n(62639),n(70322),n(70501),n(88674),n(98013),n(9632),n(26143),n(11160),n(32547),n(99673),n(67662),n(78304),n(57217),n(45949),n(32126),n(43970),n(79704),n(59312),n(8690),n(79563),n(69366),n(11188),n(36673),n(76334),n(58408),n(22970),n(42150),n(33280),n(55274),n(83549),n(37680),n(61919),n(97373),n(59848),n(74444),n(14166),n(98166),n(1849),n(23308),n(66957),n(40702),n(49035),n(92248),n(21164),n(41529),n(5531),n(78883),n(35087),n(58409),n(60876),n(15600),n(70547),n(25587),n(73791),n(75925),n(70181),n(26572),n(35459),n(19578),n(85737),n(34094),n(28666),n(13719),n(56321),n(18274),n(27894),n(22621),n(72909),n(51522),n(79826),n(85424),n(50472),n(21376),n(18813),n(9760),n(73695),n(76366),n(99382),n(40487),n(13273),n(91678),n(65510),n(8114),n(72743),n(20791),n(33817),n(61218),n(36385),n(39719),n(43994),n(25194),n(71844),n(60852),n(8921),n(74177),n(12449),n(45914),n(69931),n(18642),n(91437),n(53104),n(45883),n(26374),n(133),n(29366),n(4308),n(39754),n(27369),n(39213),n(69454),n(15568),n(20469),n(30004),n(13027),n(52016),n(64471),n(6978),n(70467),n(69213),n(23505),n(65351),n(91661),n(68487),n(75569),n(46110),n(92916),n(45140),n(20054),n(7078),n(86802),n(12414),n(7149),n(41075),n(55972),n(20705),n(60057),n(8651),n(38313),n(85513),n(40352),n(66895),n(10370)},89456:(e,t,n)=>{n.d(t,{A:()=>me});var r=n(63670),i=n(32084),o=n(8430);i.use(o.r9).init({resources:{zh:{translation:{no_space_around_full_width_punctuation:"\u5168\u89d2\u6807\u70b9\u4e0e\u5176\u4ed6\u5b57\u7b26\u4e4b\u95f4\u4e0d\u52a0\u7a7a\u683c",no_space_between_num_dp:"\u5ea6\u6570\u3001\u767e\u5206\u6bd4\u4e0e\u6570\u5b57\u4e4b\u95f4\u4e0d\u9700\u8981\u589e\u52a0\u7a7a\u683c",space_between_ch_en:"\u4e2d\u6587\u548c\u82f1\u6587\u3001\u6570\u5b57\u4e4b\u95f4\u9700\u8981\u589e\u52a0\u7a7a\u683c",uniform_punctuation:"\u7edf\u4e00\u6807\u70b9\u7b26\u53f7",content:"\u95ee\u9898\u5185\u5bb9",view:"\u67e5\u770b",fix:"\u4fee\u590d",fix_all:"\u5168\u90e8\u4fee\u590d",actions:"\u64cd\u4f5c",refresh:"\u5237\u65b0",format_target:"\u6392\u7248\u8303\u56f4",format_rule:"\u6392\u7248\u89c4\u5219",text_field_only:"\u8bf7\u9009\u62e9\u6587\u672c\u7c7b\u578b\u7684\u5b57\u6bb5",cell:"\u9009\u4e2d\u5355\u5143\u683c",field:"\u9009\u4e2d\u5217",fixing:"\u4fee\u590d\u4e2d",fix_success:"\u4fee\u590d\u6210\u529f"}},en:{translation:{no_space_around_full_width_punctuation:"No space around full-width punctuation",no_space_between_num_dp:"No space needed between numbers and degrees, percentages",space_between_ch_en:"Add space between Chinese and English, numbers",uniform_punctuation:"Uniform punctuation",content:"Content",view:"View",fix:"Fix",fix_all:"Fix All",actions:"Actions",refresh:"Refresh",format_target:"Formatting Scope",format_rule:"Formatting Rules",text_field_only:"Please select text type fields",cell:"Selected Cell",field:"Selected Column",fixing:"Fixing",fix_success:"Fix Successful"}},ja:{translation:{no_space_around_full_width_punctuation:"\u5168\u89d2\u53e5\u8aad\u70b9\u306e\u5468\u308a\u306b\u30b9\u30da\u30fc\u30b9\u3092\u5165\u308c\u306a\u3044",no_space_between_num_dp:"\u6570\u5b57\u3068\u5ea6\u6570\u3001\u30d1\u30fc\u30bb\u30f3\u30c6\u30fc\u30b8\u306e\u9593\u306b\u30b9\u30da\u30fc\u30b9\u306f\u4e0d\u8981",space_between_ch_en:"\u4e2d\u56fd\u8a9e\u3068\u82f1\u8a9e\u3001\u6570\u5b57\u306e\u9593\u306b\u30b9\u30da\u30fc\u30b9\u3092\u5165\u308c\u308b",uniform_punctuation:"\u53e5\u8aad\u70b9\u3092\u7d71\u4e00\u3059\u308b",content:"\u5185\u5bb9",view:"\u8868\u793a",fix:"\u4fee\u6b63",fix_all:"\u3059\u3079\u3066\u4fee\u6b63",actions:"\u64cd\u4f5c",refresh:"\u66f4\u65b0",format_target:"\u6574\u5f62\u7bc4\u56f2",format_rule:"\u6574\u5f62\u30eb\u30fc\u30eb",text_field_only:"\u30c6\u30ad\u30b9\u30c8\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u307f\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044",cell:"\u9078\u629e\u3057\u305f\u30bb\u30eb",field:"\u9078\u629e\u3057\u305f\u5217",fixing:"\u4fee\u6b63\u4e2d",fix_success:"\u4fee\u6b63\u5b8c\u4e86"}}},lng:"zh",fallbackLng:"en",interpolation:{escapeValue:!1}}),r.UV.bridge.getLanguage().then(i.changeLanguage).finally(console.error);var l=i,a=(n(94774),n(45079)),s=(n(8607),n(42794)),c=(n(66287),n(27221)),d=n(57970),u=n(47420),f=n(3462),p=n(87838),_=n(35699),m=n(53210),h=n(48231),g=n(76708),b=n(69860),x=n(66548),y=n(95442),v=n(99300),w=n(61228),j=n(50799),A=n(65730),O=n(11855),I=n(75291),T=n(78714),k=n(23160),C=n(52084),F=(n(18526),n(42673)),V=n(81725),N=n.n(V),S=n(73223);const U=new Worker(new URL(n.p+n.u(976),n.b)),E=(0,S.LV)(U).module,L=["space_between_ch_en","no_space_between_num_dp","uniform_punctuation","no_space_around_full_width_punctuation"],P=function(){var e=(0,u.A)(function*(e){return JSON.parse(yield(yield E).fix(JSON.stringify(e)))});return function(t){return e.apply(this,arguments)}}(),D=function(){var e=(0,u.A)(function*(e){return JSON.parse(yield(yield E).test(JSON.stringify(e)))});return function(t){return e.apply(this,arguments)}}();var J=n(63159);const M=({text:e,rulesResult:t,configs:n})=>{const{t:r}=(0,o.Bd)(),i=(0,O.useMemo)(()=>t.flatMap((e,t)=>(null==e?void 0:e.map(([e,r])=>(new(N())).retain(e).retain(r-e,{[L.indexOf(n[t])]:!0})))||[]).reduce((e,t)=>e.compose(t),new(N())([{insert:e}])),[e,t,n]);return(0,J.jsx)(J.Fragment,{children:i.map((e,t)=>{if("string"==typeof e.insert){const n=Object.keys(e.attributes||{}).filter(t=>{var n;return null===(n=e.attributes)||void 0===n?void 0:n[t]}).map(e=>Number(e));return n.length?(0,J.jsx)(F.A,{content:n.map(e=>r(L[e])).join("\n"),children:(0,J.jsx)("span",{className:"bg-red-200 border-b-2 border-red-600 cursor-pointer",children:e.insert})},t):(0,J.jsx)("span",{children:e.insert},t)}return null})})};var R=n(42216),B=n(11556),H=n(64420),z=n(73842),Z=n(59025),$=n(20211),G=n(75017),W=n(20716),q=n(87605),K=n(2633);const Q=new p.t("cell");r.UV.bridge.getData("mode").then(e=>{e&&!(0,K.A)(e)&&Q.next(e)}).catch(console.error).finally(()=>Q.pipe((0,R.F)()).subscribe(e=>{r.UV.bridge.setData("mode",e).catch(console.error)}));const X=new p.t({no_space_around_full_width_punctuation:!0,no_space_between_num_dp:!0,space_between_ch_en:!0,uniform_punctuation:!0});r.UV.bridge.getData("config").then(e=>{e&&!(0,K.A)(e)&&X.next(e)}).catch(console.error).finally(()=>X.pipe((0,R.F)(W.A)).subscribe(e=>{r.UV.bridge.setData("config",e).catch(console.error)}));const Y=(0,b.H)(r.UV.base.getSelection()).pipe((0,g.n)(e=>(0,B.h)(e=>r.UV.base.onSelectionChange(({data:t})=>e(t)),(e,t)=>t()).pipe((0,y.Z)(e))),(0,R.F)(W.A)),ee=Y.pipe((0,x.T)(({tableId:e})=>e),(0,R.F)(),(0,g.n)(e=>(0,b.H)(r.UV.base.getTableById(e)).pipe((0,g.n)(e=>(0,H.h)([(0,B.h)(t=>e.onFieldAdd(t),(e,t)=>t()),(0,B.h)(t=>e.onFieldModify(t),(e,t)=>t()),(0,B.h)(t=>e.onFieldDelete(t),(e,t)=>t())]).pipe((0,g.n)(()=>(0,z.z)([(0,b.H)(e.getFieldList()),Y.pipe((0,x.T)(({fieldId:e,recordId:t})=>({fieldId:e,recordId:t})),(0,R.F)())]).pipe((0,g.n)(([t,{fieldId:n,recordId:r}])=>{const i=t.find(({id:e})=>e===n);return i&&n&&r?(0,b.H)(i.getType()).pipe((0,x.T)(t=>({field:i,table:e,fieldType:t,fieldId:n,recordId:r}))):Z.w}),(0,y.Z)(null))),(0,y.Z)(null))),(0,$.W)(()=>(0,j.of)(null)),(0,y.Z)(null))),(0,R.F)((e,t)=>(0,W.A)((0,q.A)(e,["fieldType","fieldId","recordId"]),(0,q.A)(t,["fieldType","fieldId","recordId"]))),(0,G.u)());function te(e){return e.flatMap(({value:e,record_id:t})=>e&&r.JE.isSegments(e)?e.map(({type:e,text:t},n)=>({type:e,text:t,index:n})).filter(({type:e})=>e===r.V4.Text).map(({text:e,index:n})=>({text:e,record_id:t,index:n})):[])}function ne(){return(ne=(0,u.A)(function*(e,t,n){le.next(!0);const r=Date.now(),i=te(yield"cell"===t?e.table.getCellValue(e.fieldId,e.recordId).then(t=>[{record_id:e.recordId,value:t}]):e.field.getFieldValueList("")),o=yield D({config:n,texts:i.map(({text:e})=>e)});return console.log(`formatTest: ${Date.now()-r}ms`),le.next(!1),{config:o.config,result:Object.entries((0,I.A)(o.result.map((e,t)=>(0,d.A)({rulesResult:e},i[t])).filter(({rulesResult:e})=>e.some(k.A)),"record_id")).map(([e,t])=>({recordId:e,segments:(0,T.A)(t,"index")}))}})).apply(this,arguments)}function re(e,t,n){return ie.apply(this,arguments)}function ie(){return(ie=(0,u.A)(function*({table:e,field:t,fieldId:n},i,o){const s=a.A.loading({duration:36e5,content:l.t("fixing")}),c=yield"ALL"!==o?e.getCellValue(n,o).then(e=>[{record_id:o,value:e}]):t.getFieldValueList(""),d=te(c),{result:u}=yield P({config:Object.fromEntries(i.map(e=>[e,!0])),texts:d.map(({text:e})=>e)}),f=Object.fromEntries(c.map(({record_id:e,value:t})=>[e,t])),p={};u.forEach((e,t)=>{if(e!==d[t].text){const n=f[d[t].record_id];n&&r.JE.isSegments(n)&&(n[d[t].index].text=e),p[d[t].record_id]=!0}}),yield Promise.all((0,C.A)(Object.keys(p).filter(e=>p[e]&&f[e]),5e3).map(t=>e.setRecords(t.map(e=>({recordId:e,fields:{[n]:f[e]}}))))),s(),oe.next(Date.now()),r.UV.ui.showToast({toastType:r.Ck.success,message:l.t("fix_success")})})).apply(this,arguments)}ee.subscribe(e=>{e&&e.fieldType!==r.PU.Text&&r.UV.ui.showToast({toastType:r.Ck.warning,message:l.t("text_field_only")})});const oe=new p.t(0),le=new p.t(!1),ae=()=>(0,f.Cn)((0,f.J2)(()=>ee.pipe((0,_.i)(1),(0,m.p)(e=>Boolean(e)&&(null==e?void 0:e.fieldType)===r.PU.Text),(0,h.v)(Q,X,oe),(0,g.n)(([e,t,n])=>(0,b.H)(function(e,t,n){return ne.apply(this,arguments)}(e,t,n)).pipe((0,x.T)(t=>(0,J.jsx)(se,(0,d.A)((0,d.A)({},t),{},{selection:e}))))))),null),se=({result:e,config:t,selection:n})=>{const{t:i}=(0,o.Bd)(),l=(0,f.Cn)((0,f.J2)(()=>le.pipe((0,y.Z)(!1),(0,v.J)(),(0,w.H)(([e,t])=>e&&!t?(0,j.of)(!1).pipe((0,A.c)(300)):(0,j.of)(t)))),!1),a=(0,O.useMemo)(()=>[{title:i("content"),dataIndex:"segments",render:(e,n)=>(0,J.jsx)("div",{className:"whitespace-pre-wrap break-all",children:n.segments.map(e=>(0,O.createElement)(M,(0,d.A)((0,d.A)({},e),{},{configs:t,key:e.index})))})},{title:i("actions"),render:(e,o)=>(0,J.jsxs)("div",{className:"whitespace-nowrap",children:[(0,J.jsx)(c.A,{size:"mini",className:"mr-2",onClick:()=>r.UV.ui.showRecordDetailDialog({tableId:n.table.id,recordId:o.recordId}),children:i("view")}),(0,J.jsx)(c.A,{size:"mini",type:"primary",onClick:()=>re(n,t,o.recordId),children:i("fix")})]})}],[i,t,n]);return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)("div",{className:"gap-2 flex justify-end mb-3",children:[(0,J.jsx)(c.A,{onClick:()=>oe.next(Date.now()),loading:l,disabled:l,children:i("refresh")}),(0,J.jsx)(c.A,{type:"primary",onClick:()=>re(n,t,"ALL"),children:i("fix_all")})]}),(0,J.jsx)(s.A,{data:e,columns:a,rowKey:"recordId"})]})};n(48919);var ce=n(28729),de=(n(23438),n(42433));n(35640);const ue=n(79667).A.Group,fe=de.A.Group,pe=()=>{const e=(0,f.uu)(Q),t=(0,f.uu)(X),{t:n}=(0,o.Bd)();return(0,J.jsxs)(ce.A,{children:[(0,J.jsx)(ce.A.Item,{label:n("format_target"),children:(0,J.jsxs)(fe,{value:e,onChange:e=>Q.next(e),className:"pr-4",direction:"vertical",children:[(0,J.jsx)(de.A,{value:"cell",children:n("cell")}),(0,J.jsx)(de.A,{value:"field",children:n("field")})]})}),(0,J.jsx)(ce.A.Item,{label:n("format_rule"),children:(0,J.jsx)(ue,{options:L.map((e,t)=>({value:e,label:`${t+1}. ${n(e)}`})),value:Object.keys(t).filter(e=>t[e]),onChange:e=>X.next(Object.fromEntries(e.map(e=>[e,!0]))),direction:"vertical"})})]})},_e=()=>(0,J.jsx)(J.Fragment,{children:(0,J.jsxs)("div",{className:"py-4 px-6",children:[(0,J.jsx)(pe,{}),(0,J.jsx)(ae,{})]})});var me=()=>(0,J.jsx)("div",{children:(0,J.jsx)(_e,{})})}},l={};function a(e){var t=l[e];if(void 0!==t)return t.exports;var n=l[e]={id:e,loaded:!1,exports:{}};return o[e].call(n.exports,n,n.exports,a),n.loaded=!0,n.exports}a.m=o,e=[],a.O=(t,n,r,i)=>{if(!n){var o=1/0;for(d=0;d<e.length;d++){for(var[n,r,i]=e[d],l=!0,s=0;s<n.length;s++)(!1&i||o>=i)&&Object.keys(a.O).every(e=>a.O[e](n[s]))?n.splice(s--,1):(l=!1,i<o&&(o=i));if(l){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,r,i]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,a.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var i=Object.create(null);a.r(i);var o={};t=t||[null,n({}),n([]),n(n)];for(var l=2&r&&e;("object"==typeof l||"function"==typeof l)&&!~t.indexOf(l);l=n(l))Object.getOwnPropertyNames(l).forEach(t=>o[t]=()=>e[t]);return o.default=()=>e,a.d(i,o),i},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,n)=>(a.f[n](e,t),t),[])),a.u=e=>"static/js/async/"+e+"."+{533:"e10b2f4a",976:"8c5a84a2"}[e]+".js",a.miniCssF=e=>{},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},i="text-formatter:",a.l=(e,t,n,o)=>{if(r[e])r[e].push(t);else{var l,s;if(void 0!==n)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==i+n){l=u;break}}l||(s=!0,(l=document.createElement("script")).charset="utf-8",a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",i+n),l.src=e),r[e]=[t];var f=(t,n)=>{l.onerror=l.onload=null,clearTimeout(p);var i=r[e];if(delete r[e],l.parentNode&&l.parentNode.removeChild(l),i&&i.forEach(e=>e(n)),t)return t(n)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=f.bind(null,l.onerror),l.onload=f.bind(null,l.onload),s&&document.head.appendChild(l)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.p="./",(()=>{a.b="undefined"!=typeof document&&document.baseURI||self.location.href;var e={57:0};a.f.j=(t,n)=>{var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise((n,i)=>r=e[t]=[n,i]);n.push(r[2]=i);var o=a.p+a.u(t),l=new Error;a.l(o,n=>{if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;l.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",l.name="ChunkLoadError",l.type=i,l.request=o,r[1](l)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,[o,l,s]=n,c=0;if(o.some(t=>0!==e[t])){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(s)var d=s(a)}for(t&&t(n);c<o.length;c++)i=o[c],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(d)},n=self.webpackChunktext_formatter=self.webpackChunktext_formatter||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),a.nc=void 0,a.O(void 0,[914],()=>a(82433)),a.O(void 0,[914],()=>a(8408));var s=a.O(void 0,[914],()=>a(78025));s=a.O(s)})();